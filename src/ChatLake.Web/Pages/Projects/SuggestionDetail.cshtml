@page "{id:long}"
@model ChatLake.Web.Pages.Projects.SuggestionDetailModel

<h2>Suggestion: @Model.Suggestion?.SuggestedName</h2>

<p>
    <a asp-page="/Projects/Suggestions">Back to Suggestions</a>
</p>

@if (Model.Suggestion is null)
{
    <p><em>Suggestion not found.</em></p>
}
else
{
    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <p style="margin: 0 0 5px 0;"><strong>Project Key:</strong> <code>@Model.Suggestion.SuggestedProjectKey</code></p>
                <p style="margin: 0 0 5px 0;"><strong>Status:</strong> @Model.Suggestion.Status</p>
                @if (!string.IsNullOrEmpty(Model.Suggestion.Summary))
                {
                    <p style="margin: 0;"><strong>Summary:</strong> @Model.Suggestion.Summary</p>
                }
            </div>
            <div style="text-align: right;">
                @if (Model.Suggestion.SegmentCount > 0)
                {
                    <div style="font-size: 1.3em; font-weight: bold;">
                        @Model.Suggestion.SegmentCount segments
                    </div>
                    <div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">
                        from @Model.Conversations.Count conversations
                    </div>
                }
                else
                {
                    <div style="font-size: 1.3em; font-weight: bold;">
                        @Model.Conversations.Count conversations
                    </div>
                }
                <div style="color: @(Model.Suggestion.Confidence >= 0.7m ? "#28a745" : Model.Suggestion.Confidence >= 0.4m ? "#ffc107" : "#dc3545");">
                    @Model.Suggestion.Confidence.ToString("P0") confidence
                </div>
            </div>
        </div>
    </div>

    <h3>Conversations in this cluster</h3>

    @if (!Model.Conversations.Any())
    {
        <p><em>No conversations found.</em></p>
    }
    else
    {
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #f1f1f1;">
                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">ID</th>
                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">Title / First Message</th>
                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">Messages</th>
                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">Date</th>
                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;"></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var conv in Model.Conversations)
                {
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 10px;">@conv.ConversationId</td>
                        <td style="padding: 10px;">
                            @if (!string.IsNullOrEmpty(conv.Title))
                            {
                                @conv.Title
                            }
                            else
                            {
                                <em style="color: #999;">(No title)</em>
                            }
                        </td>
                        <td style="padding: 10px;">@conv.MessageCount</td>
                        <td style="padding: 10px;">
                            @if (conv.FirstMessageAtUtc.HasValue)
                            {
                                @conv.FirstMessageAtUtc.Value.ToLocalTime().ToString("yyyy-MM-dd")
                            }
                        </td>
                        <td style="padding: 10px;">
                            <a asp-page="/Conversations/Detail" asp-route-id="@conv.ConversationId">View</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
}
